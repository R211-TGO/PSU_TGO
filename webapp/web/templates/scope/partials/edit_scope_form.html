{# File path: /templates/scope/partials/edit_scope_form.html #}
{# This form is for editing an existing scope. It expects 'scope' and 'materials' objects. #}

<form method="POST" action="{{ url_for('scope_management.update_scope', scope_id=scope.id) }}">
    
    {# เพิ่ม input hidden เพื่อให้มี scope_id อ้างอิงได้เสมอ #}
    <input type="hidden" name="scope_id" value="{{ scope.id }}">

    <h3 class="text-xl font-semibold mb-6">
        {{ t.edit_scope }}
    </h3>

    <div class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label for="ghg_scope" class="block text-sm font-medium text-gray-700 mb-2">
                    {{ t.ghg_scope }}
                </label>
                <input type="number"
                       name="ghg_scope"
                       class="input input-bordered w-full bg-gray-100"
                       value="{{ scope.ghg_scope }}"
                       readonly>
            </div>
            <div>
                <label for="ghg_sup_scope" class="block text-sm font-medium text-gray-700 mb-2">
                    {{ t.ghg_sub_scope }}
                </label>
                <input type="number" name="ghg_sup_scope"
                       class="input input-bordered w-full bg-gray-100"
                       value="{{ scope.ghg_sup_scope }}"
                       readonly>
            </div>
        </div>

        <div>
            <label for="ghg_name" class="block text-sm font-medium text-gray-700 mb-2">
                {{ t.ghg_name }} <span class="text-red-500">*</span>
            </label>
            <input type="text" name="ghg_name"
                   class="input input-bordered w-full"
                   value="{{ scope.ghg_name }}"
                   required>
        </div>
        
        <div>
            <label for="ghg_desc" class="block text-sm font-medium text-gray-700 mb-2">
                {{ t.ghg_description }} <span class="text-red-500">*</span>
            </label>
            <textarea name="ghg_desc"
                      class="textarea textarea-bordered w-full"
                      rows="3"
                      required>{{ scope.ghg_desc }}</textarea>
        </div>

        <div class="pt-4 mt-4 border-t">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                {{ t.materials | default(t.select_materials) }}
            </label>
            
            {# นี่คือ Container ที่จะเรียกใช้ฟังก์ชันเสมอเมื่อโหลด #}
            <div id="material-list-container" 
                 class="max-h-60 overflow-y-auto bg-base-200 p-4 rounded-md space-y-2"
                 hx-post="{{ url_for('scope_management.load_materials_for_scope') }}"
                 hx-trigger="load"
                 hx-include="closest form"
                 hx-target="this"
                 hx-swap="innerHTML"
                 >
                
                {# ไม่ต้องมี include ที่นี่แล้ว แต่ใส่ spinner เพื่อให้ดูสวยงามตอนโหลดได้ #}
                <span class="loading loading-spinner text-primary"></span>

            </div>
        </div>
    </div>

    <div class="flex justify-end gap-4 pt-6 mt-6 border-t">
        <button type="button" onclick="document.getElementById('modal').classList.remove('modal-open')" class="btn btn-outline btn-secondary">
            <i data-feather="x" class="w-4 h-4 mr-2"></i>
            {{ t.cancel }}
        </button>
        <button type="submit" class="btn btn-primary">
            <i data-feather="save" class="w-4 h-4 mr-2"></i>
            {{ t.save_changes | default('Save Changes') }}
        </button>
    </div>
</form>

<script>
  // Re-initialize feather icons inside the modal
  if (typeof feather !== 'undefined') {
    feather.replace();
  }
</script>