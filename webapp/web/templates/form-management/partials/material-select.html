<select name="linked_material_name" class="select select-bordered w-full mt-1" onchange="updatePreview()">
  <option value="">üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Material ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏¥‡∏á‡∏Å‡πå</option>
  
  {% if available_form and available_form|length > 0 %}
    {% set current_scope = '' %}
    {% for form in available_form %}
      {% set scope_label = 'Scope ' + form.ghg_scope|string + '.' + form.ghg_sup_scope|string %}
      
      <!-- ‡πÅ‡∏™‡∏î‡∏á separator ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô scope -->
      {% if scope_label != current_scope %}
        {% if not loop.first %}
          <option disabled style="color: #e5e7eb; font-size: 12px;">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
        {% endif %}
        <option disabled style="color: #374151; font-weight: bold; background-color: #f3f4f6; padding: 8px;">
          üìä {{ scope_label }}
        </option>
        {% set current_scope = scope_label %}
      {% endif %}
      
      <!-- ‡πÅ‡∏™‡∏î‡∏á material option -->
      <option value="{{ form.material_name }}" 
              title="üìù {{ form.desc_form }}{% if form.variables %} | üîß Fields: {{ form.variables|join(', ') }}{% endif %}"
              style="padding-left: 20px;">
        üîó {{ form.material_name }}
        {% if form.desc_form and form.desc_form|length > 0 %}
          - {{ form.desc_form[:45] }}{% if form.desc_form|length > 45 %}...{% endif %}
        {% endif %}
      </option>
    {% endfor %}
  {% endif %}
  
  <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å materials ‡πÄ‡∏î‡∏¥‡∏° (fallback) -->
  {% if materials %}
    {% for material in materials %}
      <option value="{{ material.name }}">{{ material.name }}</option>
    {% endfor %}
  {% endif %}
</select>

<!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
<div class="mt-3 space-y-2">
  {% if available_form and available_form|length > 0 %}
    <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
    <div class="flex items-center justify-between text-xs text-gray-600 bg-blue-50 rounded-lg px-3 py-2">
      <div class="flex items-center gap-2">
        <i data-feather="database" class="w-4 h-4 text-blue-600"></i>
        <span>‡∏û‡∏ö <strong class="text-blue-700">{{ available_form|length }}</strong> Material ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ</span>
      </div>
      <div class="flex items-center gap-1 text-blue-600">
        <i data-feather="layers" class="w-3 h-3"></i>
        <span>‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Scope</span>
      </div>
    </div>
    
    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Scope -->
    {% set scope_counts = {} %}
    {% for form in available_form %}
      {% set scope_key = 'Scope ' + form.ghg_scope|string + '.' + form.ghg_sup_scope|string %}
      {% if scope_key not in scope_counts %}
        {% set _ = scope_counts.update({scope_key: 0}) %}
      {% endif %}
      {% set _ = scope_counts.update({scope_key: scope_counts[scope_key] + 1}) %}
    {% endfor %}
    
    {% if scope_counts|length > 1 %}
    <div class="text-xs text-gray-500 space-y-1">
      <div class="flex items-center gap-1 mb-1">
        <i data-feather="pie-chart" class="w-3 h-3"></i>
        <span class="font-medium">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏≤‡∏° Scope:</span>
      </div>
      <div class="grid grid-cols-2 gap-2">
        {% for scope_name, count in scope_counts.items() %}
        <div class="flex items-center justify-between bg-gray-50 rounded px-2 py-1">
          <span class="text-gray-700">{{ scope_name }}</span>
          <span class="font-medium text-gray-900 bg-white rounded-full px-2 py-0.5 text-xs">{{ count }}</span>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    
  {% elif materials and materials|length > 0 %}
    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å materials ‡πÄ‡∏î‡∏¥‡∏° -->
    <div class="flex items-center justify-between text-xs text-gray-600 bg-green-50 rounded-lg px-3 py-2">
      <div class="flex items-center gap-2">
        <i data-feather="database" class="w-4 h-4 text-green-600"></i>
        <span>‡∏û‡∏ö <strong class="text-green-700">{{ materials|length }}</strong> Material ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ</span>
      </div>
      <div class="flex items-center gap-1 text-green-600">
        <i data-feather="filter" class="w-3 h-3"></i>
        <span>‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ</span>
      </div>
    </div>
    
  {% else %}
    <!-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-lg px-3 py-3">
      <div class="flex items-center gap-2 mb-2">
        <i data-feather="alert-triangle" class="w-4 h-4 text-amber-600"></i>
        <span class="font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ Material ‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏î‡πâ</span>
      </div>
      <div class="text-xs text-amber-600 space-y-1">
        <p>‚Ä¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>
        <p>‚Ä¢ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ</p>
        <p>‚Ä¢ ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏¥‡∏á‡∏Å‡πå</p>
      </div>
    </div>
  {% endif %}
</div>

<!-- ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
<div class="mt-3 text-xs text-gray-500 bg-gray-50 rounded-lg px-3 py-2">
  <div class="flex items-start gap-2">
    <i data-feather="lightbulb" class="w-3 h-3 mt-0.5 text-yellow-500"></i>
    <div class="space-y-1">
      <p class="font-medium text-gray-700">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Material:</p>
      <ul class="space-y-0.5 text-gray-600">
        <li>‚Ä¢ ‡∏ß‡∏≤‡∏á‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</li>
        <li>‚Ä¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Material ‡∏ó‡∏µ‡πà‡∏°‡∏µ Fields ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</li>
        <li>‚Ä¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
      </ul>
    </div>
  </div>
</div>

