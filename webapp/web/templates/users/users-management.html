{% extends "/base/default_page.html" %}
{% import "/components/forms/form_renderer.html" as form_renderer %}
{% set users =[
    {
      "initials": "JD",
      "name": "John Doe",
      "email": "admin@psu.ac.th",
      "department": "IT Department",
      "role": "Admin",
      "status": "Inactive",
      "created": "15 ก.พ. 2566"
    },
    {
      "initials": "JS",
      "name": "Jane Smith",
      "email": "jane@psu.ac.th",
      "department": "Research",
      "role": "Manager",
      "status": "Active",
      "created": "10 เม.ย. 2566"
    },
    {
      "initials": "RJ",
      "name": "Robert Johnson",
      "email": "robert@psu.ac.th",
      "department": "Administration",
      "role": "User",
      "status": "Active",
      "created": "22 มิ.ย. 2566"
    },
    {
      "initials": "EC",
      "name": "Emily Chen",
      "email": "emily@psu.ac.th",
      "department": "Carbon Management",
      "role": "Viewer",
      "status": "Inactive",
      "created": "5 ส.ค. 2566"
    },
    {
      "initials": "MW",
      "name": "Michael Williams",
      "email": "michael@tgo.or.th",
      "department": "Emissions Tracking",
      "role": "Manager",
      "status": "Active",
      "created": "14 ก.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    },
    {
      "initials": "ST",
      "name": "Sarah Thompson",
      "email": "sarah@tgo.or.th",
      "department": "Climate Research",
      "role": "User",
      "status": "Active",
      "created": "3 พ.ย. 2566"
    }
  ]%}
{% for user in users %}
{% set user = user.update({"role_color": "primary" if user.role == "Admin" else "secondary" if user.role == "Manager" else "neutral"}) %}
{% endfor %}
{% set page = request.args.get('page', 1) | int %}
{% set per_page = 10 %}
{% set total_pages = (users | length // per_page) + (1 if users | length % per_page > 0 else 0) %}
{% set paginated_users = users[(page - 1) * per_page:page * per_page] %}

{% block content %}
<div class="max-w-8xl p-6 py-0">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
      <div class="relative w-full md:w-1/3">
        <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-[18px] h-[18px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        <input 
          type="text" 
          placeholder="Search users..." 
          class="input input-bordered pl-10 w-full"
        />
      </div>
      <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
        <div class="relative">
          <select class="select select-bordered pr-10 w-full md:w-auto appearance-none">
            <option>All Campuses</option>
          </select>
          <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-500 w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
        </div>
        <div class="relative">
          <select class="select select-bordered pr-10 w-full md:w-auto appearance-none">
            <option>All Faculties</option>
          </select>
          <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-500 w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
        </div>
        <button class="btn btn-primary gap-2">
          <svg class="w-[18px] h-[18px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
          Add User
        </button>
      </div>
    </div>
  
    <div class="bg-white rounded-lg border border-base-300 shadow-sm overflow-hidden">
      <div class="overflow-x-auto w-full">
        <table class="table w-full">
          <thead>
            <tr class="bg-base-200 text-base-content uppercase text-xs">
              <th class="px-4 py-3 font-medium">Name</th>
              <th class="px-4 py-3 font-medium">Department</th>
              <th class="px-4 py-3 font-medium">Role</th>
              <th class="px-4 py-3 font-medium">Status</th>
              <th class="px-4 py-3 font-medium">Created</th>
              <th class="px-4 py-3 font-medium">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in paginated_users %}
            <tr class="hover:bg-base-100 border-t border-base-200">
              <td class="px-4 py-3">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center">
                    <span class="text-sm font-medium text-gray-600">{{ user.initials }}</span>
                  </div>
                  <div>
                    <div class="font-medium">{{ user.name }}</div>
                    <div class="text-sm text-gray-500">{{ user.email }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3">{{ user.department }}</td>
              <td class="px-4 py-3">
                {% if user.role == 'Admin' %}
                  <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">{{ user.role }}</span>
                {% elif user.role == 'Manager' %}
                  <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">{{ user.role }}</span>
                {% elif user.role == 'User' %}
                  <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">{{ user.role }}</span>
                {% else %}
                  <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">{{ user.role }}</span>
                {% endif %}
              </td>
              <td class="px-4 py-3">
                <span class="inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium {% if user.status == 'Active' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                  {{ user.status }}
                </span>
              </td>
              <td class="px-4 py-3">{{ user.created }}</td>
              <td class="px-4 py-3">
                <div class="flex gap-2">
                  <button class="text-blue-500 hover:text-blue-700 transition-colors"
                    hx-get="/users/load-edit-user-role" 
                    hx-target="#modal-content" 
                    hx-swap="innerHTML" 
                    hx-on="htmx:afterRequest: document.getElementById('modal').classList.add('modal-open')">
                    <svg class="w-[18px] h-[18px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>  
                </button>
                  <button class="text-red-500 hover:text-red-700 transition-colors">
                    <svg class="w-[18px] h-[18px]" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>



    <!-- <button class="btn btn-primary mt-4 w-32" 
    hx-get="/users/load-edit-profile" 
    hx-target="#modal-content" 
    hx-swap="innerHTML" 
    hx-on="htmx:afterRequest: document.getElementById('modal').classList.add('modal-open')">
      Edit Profile
  </button> -->

    <div class="w-full flex justify-center items-center mt-4 gap-4 py-4">
        <!-- ปุ่ม Previous -->
        <button 
        class="btn btn-circle bg-base-200 hover:bg-base-300 text-base-content shadow-md transition duration-200 {% if page <= 1 %}btn-disabled opacity-50{% endif %}" 
        {% if page > 1 %}onclick="window.location.href='?page={{ page - 1 }}'"{% endif %}>
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        </button>

        <!-- ตัวเลข Page -->
        <span class="text-sm text-gray-600">
        Page <span class="font-semibold text-primary">{{ page }}</span> of <span class="font-semibold">{{ total_pages }}</span>
        </span>

        <!-- ปุ่ม Next -->
        <button 
        class="btn btn-circle bg-base-200 hover:bg-base-300 text-base-content shadow-md transition duration-200 {% if page >= total_pages %}btn-disabled opacity-50{% endif %}" 
        {% if page < total_pages %}onclick="window.location.href='?page={{ page + 1 }}'"{% endif %}>
        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
        </button>
    </div>
</div>
{% endblock content %}

