<div class="p-6">
  <form method="POST" 
        action="{{ url_for('emissions_scope.edit_scope', ghg_scope=scope.ghg_scope, ghg_sup_scope=scope.ghg_sup_scope) }}" 
        hx-post="{{ url_for('emissions_scope.edit_scope', ghg_scope=scope.ghg_scope, ghg_sup_scope=scope.ghg_sup_scope) }}" 
        hx-target="#modal-content" 
        hx-swap="innerHTML">
      
      <h3 class="text-xl font-semibold mb-4">{{ t.edit_scope }} {{ scope.ghg_scope }}.{{ scope.ghg_sup_scope }}</h3>
    
      {% if error %}
      <div class="alert alert-error shadow-lg mb-4">
          <div class="flex items-center">
              <i data-feather="alert-circle" class="w-5 h-5 mr-2"></i>
              <span>{{ error }}</span>
          </div>
      </div>
      {% endif %}

      <div class="grid grid-cols-2 gap-4 mb-6 p-4 bg-white rounded-lg border border-gray-300 shadow-md p-6">
          <div>
              <label class="block text-sm font-medium text-gray-500">{{ t.ghg_scope }}</label>
              <div class="text-lg font-semibold">{{ scope.ghg_scope }}</div>
          </div>
          <div>
              <label class="block text-sm font-medium text-gray-500">{{ t.ghg_sub_scope }}</label>
              <div class="text-lg font-semibold">{{ scope.ghg_sup_scope }}</div>
          </div>
      </div>

      <div class="mb-4">
          <label for="ghg_name" class="block text-sm font-medium text-gray-700 mb-2">
              {{ t.ghg_name }} <span class="text-red-500">*</span>
          </label>
          <input type="text" id="ghg_name" name="ghg_name" 
                 value="{{ scope.ghg_name }}" 
                 class="input input-bordered w-full" 
                 placeholder="{{ t.enter_ghg_name }}" 
                 required>
      </div>

      <div class="mb-4">
          <label for="ghg_desc" class="block text-sm font-medium text-gray-700 mb-2">
              {{ t.ghg_description }} <span class="text-red-500">*</span>
          </label>
          <textarea id="ghg_desc" name="ghg_desc" 
                    class="textarea textarea-bordered w-full" 
                    rows="3"
                    placeholder="{{ t.enter_ghg_description }}" 
                    required>{{ scope.ghg_desc }}</textarea>
      </div>

      <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">
              {{ t.head_table }}
          </label>
          <div class="text-xs text-gray-500 mb-3">{{ t.select_material_hint }}</div>
          
          {% if material_names %}
              <div class="max-h-48 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                      {% for material_name in material_names %}
                      <div class="flex items-center space-x-2 p-2 hover:bg-gray-100 rounded">
                          <input type="checkbox" 
                                 name="head_table" 
                                 value="{{ material_name }}" 
                                 id="head-{{ loop.index }}" 
                                 class="checkbox checkbox-primary checkbox-sm"
                                 {% if scope.head_table and material_name in scope.head_table %}checked{% endif %}>
                          <label for="head-{{ loop.index }}" class="text-sm cursor-pointer flex-1">
                              {{ material_name }}
                          </label>
                      </div>
                      {% endfor %}
                  </div>
              </div>
              
              <div class="mt-2 flex gap-2">
                  <button type="button" class="btn btn-xs btn-outline" onclick="selectAllMaterials()">
                      {{ t.select_all }}
                  </button>
                  <button type="button" class="btn btn-xs btn-outline" onclick="deselectAllMaterials()">
                      {{ t.deselect_all }}
                  </button>
              </div>
          {% else %}
              <div class="text-center py-4 text-gray-500">
                  <i data-feather="inbox" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                  <p class="text-sm">{{ t.no_material_names }}</p>
              </div>
          {% endif %}
      </div>

      <div class="flex justify-between pt-4 border-t">
          <button type="button" class="btn btn-outline btn-error" 
                  onclick="confirmDeleteScope({{ scope.ghg_scope }}, {{ scope.ghg_sup_scope }}, '{{ scope.ghg_name }}')">
              {{ t.delete_scope }}
          </button>  
          
          <div class="flex gap-3">
              <button type="button" class="btn btn-outline" 
                      onclick="document.getElementById('modal').classList.remove('modal-open')">
                  {{ t.cancel }}
              </button>
              <button type="submit" name="action" value="save" class="btn btn-primary">
                  {{ t.save }}
              </button>
          </div>
      </div>
  </form>
</div>

<script>
  function selectAllMaterials() {
      const checkboxes = document.querySelectorAll('input[name="head_table"]');
      checkboxes.forEach(checkbox => {
          checkbox.checked = true;
      });
  }

  function deselectAllMaterials() {
      const checkboxes = document.querySelectorAll('input[name="head_table"]');
      checkboxes.forEach(checkbox => {
          checkbox.checked = false;
      });
  }

  function confirmDeleteScope(ghgScope, ghgSupScope, ghgName) {
      if (confirm(`{{ t.confirm_delete_scope }} ${ghgScope}.${ghgSupScope}: "${ghgName}"?\n\n{{ t.action_cannot_undo }}`)) {
          fetch(`{{ url_for('emissions_scope.delete_scope', ghg_scope=0, ghg_sup_scope=0) }}`.replace('0/0', `${ghgScope}/${ghgSupScope}`), {
              method: 'DELETE',
              headers: {
                  'Content-Type': 'application/json',
              }
          })
          .then(response => response.json())
          .then(data => {
              if (data.success) {
                  document.getElementById('modal').classList.remove('modal-open');
                  setTimeout(() => {
                      location.reload();
                  }, 300);
              } else {
                  alert('Error: ' + data.message);
              }
          })
          .catch(error => {
              console.error('Error:', error);
              alert('{{ t.delete_scope_error }}');
          });
      }
  }
</script>