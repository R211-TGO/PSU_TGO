<form method="POST" action="{{ url_for('emissions_scope.add_scope') }}" hx-post="{{ url_for('emissions_scope.add_scope') }}" hx-target="#modal-content" hx-swap="innerHTML">
    <h3 class="text-xl font-semibold mb-4">เพิ่ม Scope</h3>
  
    <!-- แสดงข้อความข้อผิดพลาด -->
    {% if error %}
    <div class="alert alert-error shadow-lg mb-4">
        <span>{{ error }}</span>
    </div>
    {% endif %}

    <!-- Scope หลัก -->

    <div class="mb-4">
        <label for="ghg_scope" class="block text-sm font-medium text-gray-700">GHG Scope</label>
        <input list="ghg_scope_list" id="ghg_scope" name="ghg_scope" class="input input-bordered w-full" required oninput="updateSubScope()">
        <datalist id="ghg_scope_list">
            {% for scope in scopes %}
            <option value="{{ scope }}">{{ scope }}</option>
            {% endfor %}
        </datalist>
    </div>

    <!-- Sub-Scope -->
    <div class="mb-4">
        <label for="ghg_sup_scope" class="block text-sm font-medium text-gray-700">GHG Sub Scope</label>
        <input type="number" id="ghg_sup_scope" name="ghg_sup_scope" 
               class="input input-bordered w-full bg-gray-300 text-gray-500 cursor-not-allowed" 
               readonly required>
    </div>

    <!-- GHG Name -->
    <div class="mb-4">
        <label for="ghg_name" class="block text-sm font-medium text-gray-700">GHG Name</label>
        <input type="text" id="ghg_name" name="ghg_name" class="input input-bordered w-full" required>
    </div>

    <!-- GHG Description -->
    <div class="mb-4">
        <label for="ghg_desc" class="block text-sm font-medium text-gray-700">GHG Description</label>
        <textarea id="ghg_desc" name="ghg_desc" class="textarea textarea-bordered w-full" required></textarea>
    </div>

    <!-- Head Table -->
    <div class="mb-4">
        <label for="head_table" class="block text-sm font-medium text-gray-700">Head Table</label>
        <div class="grid grid-cols-2 gap-4">
            {% for material_name in material_names %}
            <div class="flex items-center space-x-2">
                <input type="checkbox" name="head_table" value="{{ material_name }}" id="head-{{ material_name }}" class="checkbox checkbox-primary">
                <label for="head-{{ material_name }}" class="text-sm">{{ material_name }}</label>
            </div>
            {% endfor %}
        </div>
        {% if error %}
        <p class="text-red-500 text-sm mt-2">{{ error }}</p>
        {% endif %}
    </div>

    <!-- ปุ่ม -->
    <div class="flex justify-end gap-4">
        <button type="button" class="btn btn-secondary" onclick="document.getElementById('modal').classList.remove('modal-open')">ยกเลิก</button>
        <button type="submit" name="action" value="save" class="btn btn-primary">บันทึก</button>
    </div>
</form>

<script>
    function updateSubScope() {
        const ghgScope = document.getElementById("ghg_scope").value;
        const subScopeInput = document.getElementById("ghg_sup_scope");

        if (ghgScope) {
            fetch("{{ url_for('emissions_scope.get_latest_sub_scope') }}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ ghg_scope: ghgScope }),
            })
            .then((response) => response.json())
            .then((data) => {
                subScopeInput.value = data.latest_sub_scope;
            })
            .catch((error) => {
                console.error("Error fetching sub-scope:", error);
            });
        } else {
            subScopeInput.value = "";
        }
    }
</script>